name: decoder/aws-json/0

metadata:
  title: Wazuh wodle AWS integration JSON Decoder
  description: Partial JSON decoder for AWS wodle events
  module: AWS
  compatibility: >
    This decoder has been tested on Wazuh version 4.4
  references:
    - https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/wodle-s3.html
  versions:
    - "4.4"
  author:
    name: Wazuh, Inc.
    date: 2023/05/04

sources:
  - decoder/integrations/0

# Wodle output              -> "location": "Wazuh-AWS"
# How it should be received -> "location": "[NNN] (MMMMM) any->Wazuh-AWS"
#                                                             <-origin->
check: +starts_with/event.original/{ AND ( +string_equal/wazuh.origin/Wazuh-AWS OR +string_equal/wazuh.location/Wazuh-AWS )

parse:
  logpar:
    - event.original: <~json/json>

normalize:
 - map:
    - wazuh.decoders: +array_append/aws-json

 - check:
    - ~json.integration: aws
   map:
    - event.module: aws
